<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расчет азимута для антенны до БС</title>
</head>
<body>
    <div>
        <div>
            <label>Широта вышки (для с.ш. положит., для ю.ш. отриц.): <input type="text" id="targetLat" placeholder="55,7558"></label>
        </div>
        <div>
            <label>Долгота вышки (для в.д. положит., для з.д. отриц.): <input type="text" id="targetLon" placeholder="37,6173"></label>
        </div>
        <button onclick="calculate()">Рассчитать азимут</button>
    </div>
    <div id="result"></div>

    <script>
        function parseCoordinate(str) {
            return parseFloat(str.replace(',', '.'));
        }

        function calculateAzimuth(lat1, lon1, lat2, lon2) {
            const toRad = Math.PI / 180;
            const phi1 = lat1 * toRad;
            const phi2 = lat2 * toRad;
            const lambda1 = lon1 * toRad;
            const lambda2 = lon2 * toRad;

            const y = Math.sin(lambda2 - lambda1) * Math.cos(phi2);
            const x = Math.cos(phi1) * Math.sin(phi2) - 
                      Math.sin(phi1) * Math.cos(phi2) * Math.cos(lambda2 - lambda1);
            
            let azimuth = Math.atan2(y, x) * (180 / Math.PI);
            return (azimuth + 360) % 360;
        }

        function calculate() {
            const targetLatInput = document.getElementById('targetLat').value;
            const targetLonInput = document.getElementById('targetLon').value;

            if (!targetLatInput || !targetLonInput) {
                document.getElementById('result').textContent = 'Введите координаты';
                return;
            }

            const targetLat = parseCoordinate(targetLatInput);
            const targetLon = parseCoordinate(targetLonInput);

            if (isNaN(targetLat) || isNaN(targetLon)) {
                document.getElementById('result').textContent = 'Неверный формат координат';
                return;
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const currentLat = position.coords.latitude;
                        const currentLon = position.coords.longitude;
                        
                        const azimuth = calculateAzimuth(
                            currentLat, 
                            currentLon, 
                            targetLat, 
                            targetLon
                        );
                        
                        document.getElementById('result').textContent = 
                            'Азимут: ' + azimuth.toFixed(2) + '°';
                    },
                    (error) => {
                        document.getElementById('result').textContent = 
                            'Ошибка получения геолокации: ' + error.message;
                    }
                );
            } else {
                document.getElementById('result').textContent = 
                    'Геолокация не поддерживается';
            }
        }
    </script>
</body>
</html>
